<div class="od-projects">
    
	<h1 class="od-title">Projekt: {{ vm.project_title }}</h1>

	<div layout="row" layout-align="space-between center">
		<a class="md-button" style="font-size: 14px" href="#/projekter"><i class="material-icons">arrow_back</i> Tilbage til projekter</a>
		
		<div  class="od-search" layout="row">
			<span flex></span>
			<form name="doSearch" ng-submit="vm.getSearchresults(searchText);">
				<!-- <md-input-container> -->
					<i class="material-icons">search</i>
					<md-autocomplete
							required
							md-input-name="autocomplete"
							md-selected-item="searchQuery"
							md-search-text="searchText"
							md-items="r in vm.getAutoSuggestions(searchText)"
							md-item-text="r.name"
							md-floating-label="Søg">
						<md-item-template>
							<span md-highlight-text="searchText" ng-click="vm.gotoPath(r.nodeRef);">{{r.name}}</span>
						</md-item-template>
						<div ng-messages="autocompleteForm.autocomplete.$error">
							<div ng-message="required">Dette felt skal udfyldes</div>
						</div>
					</md-autocomplete>
				<!-- </md-input-container> -->
					<!-- <md-button type="submit" class="md-primary">Søg</md-button> -->
			</form>
		</div>
	</div>

	<div layout-gt-sm="row">
		<md-card flex-gt-sm="70">
			<md-card-content>
				<h2 class="od-title-icon"><i class="material-icons">library_books</i>Dokumenter</h2>
			
				<breadcrumb paths="vm.paths"></breadcrumb>
				
				<md-list class="sortHead">
									
					<table class="od-members od-members-row">
						<thead fix-head>
						<tr>
							<th sort-table="name" sort-default="!reverse" title="Sortér kolonne">Navn</th>
							<th colspan="3" sort-table="lastChanged" title="Sortér kolonne">Historik</th>
						</tr>
						</thead>
						<tbody>							
																						
							<tr ng-show="content.contentType === 'cmis:document'" ng-repeat="content in contents | orderObjectBy:orderByAttribute:reverseOrder">	
								
								<td><a class="od-filebrowser-link" ng-href="#/dokument/{{content.shortRef}}">
									<i class="material-icons" ng-show="content.contentType === 'cmis:document'">insert_drive_file</i>
									{{content.name}}</a></td>																
								<td>
									<table>
										<tr>
											<td style="border: none; margin: 0; padding: 0">
												<a class="od-filebrowser-link" ng-href="#/dokument/{{content.shortRef}}">{{content.lastChanged | openeDate}}&nbsp;-&nbsp;{{content.lastChangedBy}}</a>
											</td>
											<td ng-show="content.hasHistory" style="border: none; margin: 0; padding: 0">
												<md-menu md-position-mode="left bottom">
													<md-button class="md-icon-button" aria-label="Se historik" ng-click="$mdOpenMenu($event); vm.loadHistory(content.shortRef)">
														<md-icon md-menu-origin" title="Se historik" style="font-size: 22px; position: relative; top: 5px">history</md-icon>
													</md-button>
													<md-menu-content>
														<md-menu-item class="menuListHead">
															Ændret
															<span style="width: 70px;"></span>
															Ændret af														
														</md-menu-item>
														<md-menu-item ng-repeat="h in history" class="menuList">
															<a href="/#/dokument/{{h.nodeRef}}?archived=true&parent={{h.parent_nodeRef}}">
															{{ h.created | openeDate }}&nbsp;&nbsp;&nbsp;&nbsp;{{ h.modifier }}</a>												
															</md-button>
														</md-menu-item>
													</md-menu-content>										
												</md-menu>
											</td>
										</tr>
									</table>
								</td>									
								<td>
								<md-menu>
									<md-button class="md-icon-button" ng-click="vm.openMenu($mdOpenMenu, $event)">
										<md-icon md-menu-origin>dehaze</md-icon>
									</md-button>
		
									<md-menu-content width="6">
										<md-menu-item>
											<md-button ng-click="vm.downloadDocument(content.nodeRef, content.name)">
												<md-icon md-menu-align-target>get_app</md-icon>
												Download
											</md-button>
										</md-menu-item>
		
										<md-menu-item>
											<md-button ng-click="vm.previewDocument(content.nodeRef)">
												<md-icon md-menu-align-target>search</md-icon>
												Preview
											</md-button>
										</md-menu-item>
		
										<md-menu-item>
											<md-button ng-disabled="vm.userRole === 'SiteConsumer'" ng-click="vm.deleteFileDialog($event, content.nodeRef)">
												<md-icon md-menu-align-target>remove_circle_outline</md-icon>
												Slet
											</md-button>
										</md-menu-item>
		
										<md-menu-item>
											<md-button ng-disabled="vm.userRole === 'SiteConsumer'" ng-click="vm.renameDocumentDialog($event, content.nodeRef)">
												<md-icon md-menu-align-target>create</md-icon>
												Omdøb
											</md-button>
										</md-menu-item>

										
										<md-menu-item>
											<md-button ng-disabled="vm.userRole === 'SiteConsumer'" ng-click="vm.copyFileDialog($event, content.nodeRef, content.parentNodeRef)">
												<md-icon md-menu-align-target>content_copy</md-icon>
												Kopiér
											</md-button>
										</md-menu-item>
										
										<md-menu-item>
											<md-button ng-disabled="vm.userRole === 'SiteConsumer'" ng-click="vm.moveFileDialog($event, content.nodeRef, content.parentNodeRef)">
												<md-icon md-menu-align-target>compare_arrows</md-icon>
												Flyt
											</md-button>
										</md-menu-item>


										<md-menu-item>
											<md-button ng-click="vm.reviewDocumentsDialog($event, content.nodeRef)">
												<md-icon md-menu-align-target>playlist_add_check</md-icon>
												Send til godkendelse
											</md-button>
										</md-menu-item>


									</md-menu-content>
								</md-menu>
								</td>
							</tr>
							<tr ng-show="content.contentType === 'cmis:folder'" ng-repeat="content in contents | orderObjectBy:orderByAttribute:reverseOrder">

								<td><a class="od-filebrowser-link" ng-href="#/projekter/{{vm.project}}{{vm.path}}/{{content.name}}">
									<i class="material-icons" ng-show="content.contentType === 'cmis:folder'">folder</i>
									{{content.name}}
								</a></td>
								<td><a class="od-filebrowser-link" ng-href="#/projekter/{{vm.project}}{{vm.path}}/{{content.name}}">{{content.lastChanged | openeDate}}&nbsp;-&nbsp;{{content.lastChangedBy}}</a></td>
								<td>
									<md-menu>
										<md-button class="md-icon-button" ng-click="vm.openMenu($mdOpenMenu, $event)">
											<md-icon md-menu-origin>dehaze</md-icon>
										</md-button>

										<md-menu-content width="6">
											<md-menu-item>
												<md-button ng-disabled="vm.userRole === 'SiteConsumer'" ng-click="vm.deleteFoldereDialog($event, content.nodeRef)">
													<md-icon md-menu-align-target>remove_circle_outline</md-icon>
													Slet
												</md-button>
											</md-menu-item>

											<!-- <md-menu-item>
                                            <md-button ng-click="">
                                                <md-icon md-menu-align-target>create</md-icon>
                                                Rename
                                            </md-button>
                                            </md-menu-item> -->
										</md-menu-content>
									</md-menu>
								</td>
							</tr>
							<tr ng-show="content.contentType === 'cmis:link'" ng-repeat="content in contents | orderObjectBy:orderByAttribute:reverseOrder">

								<td><a class="od-filebrowser-link" ng-href="#/projekter/{{content.destination_link}}">
									<i class="material-icons" ng-show="content.contentType === 'cmis:link'">content_paste</i>
									{{content.name}}
								</a></td>
								<td>
									<md-menu>
										<md-button class="md-icon-button" ng-click="vm.openMenu($mdOpenMenu, $event)">
											<md-icon md-menu-origin>dehaze</md-icon>
										</md-button>

										<md-menu-content width="6">
											<md-menu-item>
												<md-button ng-disabled="vm.userRole === 'SiteConsumer'" ng-click="vm.deleteLink(content.nodeid, content.destination_nodeid)">
													<md-icon md-menu-align-target>remove_circle_outline</md-icon>
													Slet
												</md-button>
											</md-menu-item>

											<!-- <md-menu-item>
                                            <md-button ng-click="">
                                                <md-icon md-menu-align-target>create</md-icon>
                                                Rename
                                            </md-button>
                                            </md-menu-item> -->
										</md-menu-content>
									</md-menu>
								</td>
							</tr>
						</tbody>						
					</table>
				</md-list>

				<p ng-show="contents.length === 0">
					Denne mappe er tom
				</p>
				<md-divider></md-divider>
				<div layout="row" layout-align="start center" class="btnAlign">
					<md-button ng-if="vm.userRole !== 'SiteConsumer'" class="md-raised md-primary" ng-click="vm.uploadDocumentsDialog($event)"><i class="material-icons">file_upload</i> Upload dokumenter</md-button>
					<md-button ng-if="vm.userRole !== 'SiteConsumer'" class="md-raised" ng-click="vm.newFolderDialog($event)"><i class="material-icons">add</i> Opret ny mappe</md-button>
					<md-button ng-if="vm.userRole !== 'SiteConsumer'" class="md-raised" ng-click="vm.newLinkDialog($event)"><i class="material-icons">add</i> Opret projektlink</md-button>
				</div>
			</md-card-content>											
		</md-card>

        <!-- Needs an ng-if in order to display on basic sites only -->
		<md-card flex-gt-sm="30">
			<md-card-content>
				<h3 class="od-title-icon"><i class="material-icons">group</i>Medlemmer tilknyttet projektet</h3>
				<md-list class="od-members">
					<md-list-item ng-repeat="member in members">	
						<div flex="50" flex-gt-lg="60">
                            {{ member.authority.firstName }} {{ member.authority.lastName }}
                        </div>
                        <div flex="30">
                            {{ role_mapping[member.role] }}
                        </div>
                        <div flex="20" flex-gt-lg="10" style="text-align: right;">
                            <md-menu ng-if="vm.userRole === 'SiteManager'">			
                                <md-button class="md-icon-button" ng-click="vm.openMenu($mdOpenMenu, $event)">
                                    <md-icon md-menu-origin>dehaze</md-icon>
                                </md-button>
                            
                                <md-menu-content width="6">
                                    <md-menu-item>
                                        <md-button ng-click="vm.updateMemberRoleDialog($event, member.authority)">
                                            <md-icon md-menu-align-target>create</md-icon>
                                            Redigér medlem
                                        </md-button>
                                    </md-menu-item>
                              
                                    <md-menu-item>
                                        <md-button ng-click="vm.deleteMemberDialog(vm.project, member.authority.userName);">
                                            <md-icon md-menu-align-target>remove_circle_outline</md-icon>
                                            Slet
                                        </md-button>
                                    </md-menu-item>
                                </md-menu-content>
                            </md-menu>
                        </div>
                        <md-divider></md-divider>
					</md-list-item>			 			  
				</md-list>
			
                <div layout="row" layout-align="start center" class="btnAlign">
                    <md-button ng-if="vm.userRole === 'SiteManager'" class="md-raised" ng-click="vm.newMember($event)"><i class="material-icons">add</i> Tilføj medlem&nbsp;&nbsp;</md-button>
                </div>
            </md-card-content>
        </md-card>

	</div>
    
    <!-- Needs an ng-if in order to display on advanced sites only -->
    <div ng-include="'app/src/sites/modules/pd_sites/view/groups_overview.html'"></div>

</div>
